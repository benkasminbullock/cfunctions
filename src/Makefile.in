# contains code contributed by Egil Kvaleberg.

prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
sharedir = ${prefix}/share/cfunctions

SHELL=/bin/sh
FLEX = @FLEX@
CC = @CC@
CPPFLAGS = -I. @CPPFLAGS@
CFLAGS = @CFLAGS@ @CPPFLAGS@
VERSION = @VERSION@
GCOV = @GCOV@
INSTALL = @INSTALL@
CWD = $(shell pwd)
srcdir = @srcdir@
LIB_DIR = $(srcdir)/missing
FLEX_CFLAGS = @FLEX_CFLAGS@
MKDEP = gcc $(CPPFLAGS) -MM
RC = rc
CFUNCTIONS = @CFUNCTIONS@
SOURCES =  \
argument.c \
backup.c \
c-word.c \
cfunctions.c \
cpp.c \
error-msg.c \
file-name.c \
file.c \
options.c \
print-usage.c \
sys_or_exit.c \
wt.c

OBJS =  \
argument.o \
backup.o \
c-word.o \
cfunctions.o \
error-msg.o \
file-name.o \
file.o \
options.o \
print-usage.o \
sys_or_exit.o \
wt.o

HEADERS =  \
argument.h \
backup.h \
c-word.h \
cfunctions.h \
error-msg.h \
file-name.h \
file.h \
options.h \
print-usage.h \
sys_or_exit.h \
wt.h

# if you get into trouble, just delete the following rule.

all: cfunctions 

cfunctions:	$(OBJS)
	$(CC) $(CFLAGS) -o cfunctions $(OBJS)

cfunctions.c:	cfunctions.fl
	if [ -f $@ ]; then chmod 0644 $@; fi
	$(FLEX) -o cfunctions.c cfunctions.fl
	chmod 0444 $@

OPTIONS_FILES = sys_or_exit.o error-msg.o file.o
OPTIONS_INCLUDES = sys_or_exit.h error-msg.h c-extensions.h \
		 options.h config.h file.h

options:        options.c $(OPTIONS_FILES) $(OPTIONS_INCLUDES)
	$(CC) $(CPPFLAGS) $(CFLAGS) -o options -DMANUAL \
	options.c $(OPTIONS_FILES)

.c.gcov:
	$(GCOV)	-b $<

coverage:	*.gcov

# This target removes extra coverage files

check-clean:
	rm -f 	*.da *.bb *.bbg *.gcov coverage

clean:	
	rm -f cfunctions $(OBJS) options TAGS

distclean:	clean
	rm -f defines.h man.head Makefile config.h

realclean:	distclean
	rm -f cfunctions.c configure version.texi options.texi LSM \
	index.html $(HEADERS)

# Rules for functions which might be missing from the operating system.

strstr.o:	$(LIB_DIR)/strstr.c

getopt_long.o:	$(LIB_DIR)/getopt_long.c

install:	all
	$(INSTALL) cfunctions $(bindir)
	if test ! -d ${sharedir} ; then \
          mkdir ${sharedir} ;\
	fi
	$(INSTALL) -m 644 c-extensions.h ${sharedir}

uninstall:
	rm -rf ${sharedir}
	rm -f ${bindir}/cfunctions

argument.o: argument.c argument.h wt.h sys_or_exit.h error-msg.h

backup.o: backup.c backup.h sys_or_exit.h error-msg.h

c-word.o: c-word.c c-word.h 

cfunctions.o: cfunctions.c argument.h wt.h error-msg.h

error-msg.o: error-msg.c error-msg.h

file.o: file.c file.h error-msg.h 

options.o: options.c options.h sys_or_exit.h  options.h config.h file.h

print-usage.o: print-usage.c print-usage.h error-msg.h sys_or_exit.h 

wt.o: wt.c config.h error-msg.h  sys_or_exit.h file.h file-name.h \
	options.h backup.h argument.h

test:
	cd ..;make test
