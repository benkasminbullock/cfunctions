# This file is part of Cfunctions.
#
# Copyright (C) 1998 Ben K. Bullock
#
# Cfunctions is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# Cfunctions is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Cfunctions; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA

# See the file `COPYING' for copying conditions.

# contains code contributed by Egil Kvaleberg.

datarootdir = @datarootdir@
prefix = @prefix@
mandir = @mandir@
sharedir = ${prefix}/share/cfunctions
infodir = ${prefix}/info
srcdir = @srcdir@

SHELL=/bin/sh
MAKEINFO = makeinfo
TEXI2DVI = texi2dvi
TEXI2HTML = texi2html -menu
CPPFLAGS = -I. @CPPFLAGS@
VERSION = @VERSION@
INSTALL = @INSTALL@
CWD = $(shell pwd)

# `configure' will work out whether to rebuild documentation from
# altered sources.

DOC_TARGETS = @DOC_TARGETS@ cfunctions.1
TEXINFO_FILES = cfunctions.texi options.texi

all: $(DOC_TARGETS)

# Make documentation files for Cfunctions

info:	cfunctions.info

dvi:	cfunctions.dvi

html:	cfunctions.html cfunctions_toc.html

# This is for building the online manual for the WWW pages.

online-man:	$(TEXINFO_FILES)
	-mkdir online-man
	cp $(TEXINFO_FILES) online-man
	cd online-man;$(TEXI2HTML) -menu -split_node -number cfunctions.texi
	cd online-man;rm $(TEXINFO_FILES)

cfunctions.info:	$(TEXINFO_FILES)
	$(MAKEINFO)	$(srcdir)/cfunctions.texi

cfunctions.dvi:		$(TEXINFO_FILES)
	$(TEXI2DVI) 	$(srcdir)/cfunctions.texi

cfunctions.html cfunctions_toc.html:	$(TEXINFO_FILES)
	$(TEXI2HTML)    $(srcdir)/cfunctions.texi

# options.texi is automatically generated

options.texi:   ../src/options.c
	cd ../src/; $(MAKE) options
	${srcdir}/../src/options -t > options.texi

cfunctions.1: 	../src/options.c man.head.in man.tail
	cd ../src/; $(MAKE) options
	${srcdir}/../src/options -m \
	|sed s/@var{argument}/\\\\fIargument\\\\fP/g> $@

# This target removes all the files generated by texinfo.  Texinfo
# makes all these index files even when you don't ask for them.

tex-clean:
	rm -f 	cfunctions.cp cfunctions.cps \
	      	cfunctions.pg cfunctions.pgs \
	      	cfunctions.fn cfunctions.fns \
	      	cfunctions.tp cfunctions.tps \
	      	cfunctions.vr cfunctions.vrs \
	      	cfunctions.ky cfunctions.kys \
	      	cfunctions.dvi cfunctions.log \
	      	cfunctions.aux cfunctions.toc

# This target removes all the files generated by `texi2html'.

html-clean:
	rm -f   cfunctions.html cfunctions_toc.html cfunctions_foot.html 

# This target removes all the files generated by `makeinfo'.

info-clean:
	rm -f   cfunctions.info cfunctions.info-[1-9]

online-man-clean:
	rm -rf online-man

clean:		tex-clean online-man-clean
	rm -rf fakefile

distclean:	clean
	rm -f man.head Makefile version.texi

man-clean:
	rm -f cfunctions.1

# `realclean' removes files that are part of the distribution, but are
# automatically generated.

realclean:	clean html-clean info-clean man-clean

install-man: 	cfunctions.1
	$(INSTALL) -m 644 cfunctions.1 $(mandir)/man1

install:	install-man
	$(INSTALL) -m 644 cfunctions.info* ${infodir}
	-install-info --info-file=cfunctions.info \
		      --info-dir=$(infodir)

# Let's get rid of this rubbish!

uninstall-man:
	-rm -f $(mandir)/man1/cfunctions.1

uninstall: uninstall-man
	-rm -f $(infodir)/cfunctions.info*
	-install-info --delete --info-file=cfunctions.info \
		      --info-dir=$(infodir)

