# Cfunctions makefile template for autotools.

SHELL=/bin/sh
VERSION = @VERSION@
BZIP2 = bzip2

all: 
	cd src;make;cd ../doc;make

test:	all
	cd tests/; prove --nocolor test.pl


thisdir_clean:
	rm -f cfunctions-*.*.tar.gz cfunctions-*.*.tar.bz2 .cfunctions* TAGS

clean:	thisdir_clean
	cd src; make clean
	cd doc; make clean

thisdir_distclean: thisdir_clean
	rm -f config.status config.log config.cache
	rm -rf autom4te.cache
	cd tests; rm -f test.perl *.o *.h a.out core

distclean: thisdir_distclean

thisdir_realclean: thisdir_distclean
	rm -f configure

realclean: thisdir_realclean
	cd src; make realclean; cd ../doc; make realclean

DISTFILES = doc src tests contrib missing \
	COPYING README NEWS AUTHORS VERSION \
	configure configure.ac Makefile.in Makefile \
	fake-cfunctions install-sh

dist:	distfiles
	rm -rf cfunctions-${VERSION}.tar.bz2 cfunctions-${VERSION}.tar.gz \
		cfunctions-$(VERSION) cfunctions-$(VERSION).tar
	rm -f options 
	mkdir cfunctions-$(VERSION)
# copy the distributed files into the distribution directory and set
# the permissions.
	cp -R $(DISTFILES) cfunctions-$(VERSION)
	chmod -R -s cfunctions-$(VERSION)
	chmod -R g=rX cfunctions-$(VERSION)
	cd cfunctions-${VERSION}
# remove core and backup files from distribution
	-find cfunctions-$(VERSION) -name "*~" | xargs rm -f
	-find cfunctions-$(VERSION) -name "core" | xargs rm -f
	cd cfunctions-$(VERSION)/doc; make distclean
	cd cfunctions-$(VERSION)/src; make distclean
	cd cfunctions-$(VERSION); make distclean
	tar cf cfunctions-$(VERSION).tar cfunctions-$(VERSION)
# bzip2 has a --keep option, and gzip doesn't, so the bzip2 file
# should be made first.
	$(BZIP2) --keep cfunctions-${VERSION}.tar
	gzip cfunctions-${VERSION}.tar

distfiles: 
	cd doc; make index.html cfunctions.1 html info options.texi
	cd src; make cfunctions.c

install:
	cd src; make install; cd ../doc; make install

uninstall: 
	cd src; make uninstall; cd ../doc; make uninstall
